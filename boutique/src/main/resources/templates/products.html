<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title th:text="${currentCategory} + ' | Anvi Studio'"></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <style>
        :root{
            --brand:#ff7c04;
            --dark:#222;
            --filter-border: #ddd; /* Light border for filter sections */
        }
        /* Fix: Set min-height for full viewport and remove default margin/padding if needed */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f7f7f7;
            color: #222;
            min-height: 100vh; /* Ensure full viewport coverage */
            display: flex;
            flex-direction: column; /* Allows footer to be pushed to the bottom */
        }
        /* New Style for Offer Bar */
        .offer-bar{
            background: linear-gradient(90deg,#111, #222);
            color:#fff;
            padding:6px 0;
            font-size:0.95rem;
        }
        .offer-bar a{ color:var(--brand); text-decoration:none; font-weight:600; }

        .main-nav{ background:#000; color:#fff; }
        /* *** FIX: Ensure active links are always clearly visible *** */
        .main-nav .nav-link{ color:#fff; }
        .main-nav .nav-link:hover,
        .main-nav .nav-link.active {
            color: var(--brand); /* Active/Hover color */
            font-weight: 700;    /* Make active link bold */
            border-bottom: 2px solid var(--brand); /* Subtle underline for clarity */
            padding-bottom: 4px;
        }
        /* *** END FIX *** */

        .navbar-nav { align-items: center; }
        .product-card{ border-radius:12px; overflow:hidden; border:1px solid #eee; }
        .product-card .card-img-top{ height:350px; object-fit:cover; }
        .btn-brand { background-color: var(--brand); border-color: var(--brand); color: white; }
        .btn-brand:hover { background-color: #cc6300; border-color: #cc6300; }
        .hero-title { font-family: 'Playfair Display', serif; font-weight: 700; color: #000; }

        /* Content wrapper to allow the footer to stick to the bottom */
        .main-content {
            flex-grow: 1; /* This pushes the footer down */
        }

        /* Filter Sidebar Styles */
        .filter-sidebar {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .filter-group {
            border-bottom: 1px solid var(--filter-border);
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        .filter-group:last-child {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }
        .color-swatch {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: inline-block;
            cursor: pointer;
            border: 2px solid transparent;
            margin-right: 10px;
            transition: border-color 0.2s;
        }
        /* Color active state needs adjustment if color filtering is fully implemented */
        .color-swatch-wrapper {
            margin-right: 8px;
        }
        /* FIX: Active state for color swatch when radio button is checked */
        .color-swatch-wrapper input:checked + .color-swatch {
            border-color: var(--dark);
            box-shadow: 0 0 0 3px rgba(255, 124, 4, 0.4);
        }
        .color-label {
            display: flex;
            align-items: center;
            margin-right: 15px;
            margin-bottom: 8px;
            cursor: pointer;
        }
        .color-label span {
            margin-left: 5px;
        }

        /* Footer styling for consistency */
        footer {
            background-color: var(--dark);
            color: #fff;
        }
    </style>
</head>
<body>

<!-- 1. ADDED: Offer bar for consistency -->
<div class="offer-bar text-center">
    <div class="container">Free Shipping on Orders Above ₹1999 — Use code <a href="#" style="color:var(--brand); text-decoration:none; font-weight:600;">FREESHIP</a></div>
</div>

<!-- NAVBAR (Standardized from index.html) -->
<nav class="navbar navbar-expand-lg main-nav">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="/">
            <img th:src="@{/images/Chaknik_Logo.png}" alt="Anvi Studio Logo" style="height:75px; margin-right:4px;">
            <span class="text-white">Anvi Studio</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="mainNav">

            <!-- 1. MAIN LINKS (Using the expanded list of categories) -->
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link" href="/">Home</a></li>

                <!-- *** NEW ARRIVALS TAB *** -->
                <li class="nav-item">
                    <a class="nav-link"
                       th:classappend="${selectedSortBy == 'latest' or selectedSortBy == 'newest'} ? 'active'"
                       th:href="@{/products(sortBy='latest')}">New Arrivals</a>
                </li>

                <!-- Shop Dropdown (Active if any non-New Arrivals filter is applied) -->
                <li class="nav-item dropdown"
                    th:classappend="${currentCategory != 'All Products' and currentCategory != null} ? 'active'">
                    <a class="nav-link dropdown-toggle"
                       href="#" id="shopDropdown" role="button"
                       data-bs-toggle="dropdown"
                       th:classappend="${currentCategory != 'All Products' and currentCategory != null} ? 'active'">Shop</a>
                    <ul class="dropdown-menu" aria-labelledby="shopDropdown">
                        <li><a class="dropdown-item" th:href="@{/products(category='Long Frocks')}" th:classappend="${currentCategory == 'Long Frocks'} ? 'active'">Long Frocks</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Lehengas')}" th:classappend="${currentCategory == 'Lehengas'} ? 'active'">Lehengas</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Mom & Me')}" th:classappend="${currentCategory == 'Mom & Me'} ? 'active'">Mom & Me</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Crop Top – Skirts')}" th:classappend="${currentCategory == 'Crop Top – Skirts'} ? 'active'">Crop Top – Skirts</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Handlooms')}" th:classappend="${currentCategory == 'Handlooms'} ? 'active'">Handlooms</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Casual Frocks')}" th:classappend="${currentCategory == 'Casual Frocks'} ? 'active'">Casual Frocks</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Ready To Wear')}" th:classappend="${currentCategory == 'Ready To Wear'} ? 'active'">Ready To Wear</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Dupattas')}" th:classappend="${currentCategory == 'Dupattas'} ? 'active'">Dupattas</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Kids wear')}" th:classappend="${currentCategory == 'Kids wear'} ? 'active'">Kids wear</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Dress Material')}" th:classappend="${currentCategory == 'Dress Material'} ? 'active'">Dress Material</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Sarees')}" th:classappend="${currentCategory == 'Sarees'} ? 'active'">Sarees</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Blouses')}" th:classappend="${currentCategory == 'Blouses'} ? 'active'">Blouses</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Fabrics')}" th:classappend="${currentCategory == 'Fabrics'} ? 'active'">Fabrics</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <!-- Active class for 'All Products' link -->
                        <li><a class="dropdown-item"
                               th:classappend="${currentCategory == 'All Products'} ? 'active'"
                               th:href="@{/products}">All Products</a></li>
                    </ul>
                </li>
                <li class="nav-item"><a class="nav-link" href="/about">About</a></li>
                <li class="nav-item"><a class="nav-link" href="/contact">Contact</a></li>
            </ul>

            <!-- 2. ICON GROUP (Right side) -->
            <ul class="navbar-nav mb-2 mb-lg-0">
                <li class="nav-item" sec:authorize="!isAuthenticated()">
                    <a class="nav-link" th:href="@{/login}" title="Login"><i class="fa fa-user"></i></a>
                </li>
                <li class="nav-item" sec:authorize="isAuthenticated()">
                    <span class="nav-link text-white"><i class="fa fa-user me-1"></i><span sec:authentication="name">User</span></span>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/wishlist-unauth}" sec:authorize="!isAuthenticated()" title="Wishlist"><i class="fa-regular fa-heart"></i></a>
                    <a class="nav-link" th:href="@{/wishlist}" sec:authorize="isAuthenticated()" title="My Wishlist"><i class="fa-regular fa-heart"></i></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/cart-unauth}" sec:authorize="!isAuthenticated()" title="Cart"><i class="fa fa-shopping-cart"></i></a>
                    <a class="nav-link" th:href="@{/cart}" sec:authorize="isAuthenticated()" title="My Cart"><i class="fa fa-shopping-cart"></i></a>
                </li>
                <li class="nav-item" sec:authorize="isAuthenticated()">
                    <form th:action="@{/logout}" method="post" class="d-inline">
                        <button type="submit" class="btn btn-danger btn-sm"><i class="fa fa-sign-out-alt me-1"></i> Logout</button>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- 2. ADDED: Main Content Wrapper -->
<div class="main-content">
    <div class="container my-5">
        <h1 class="hero-title display-5 mb-4" th:text="${currentCategory}">Product Catalog</h1>
        <hr>

        <div class="row g-4 mt-4">

            <!-- Left Column: Filter Sidebar (col-lg-3) -->
            <div class="col-lg-3">
                <div class="filter-sidebar sticky-top" style="top: 20px;">
                    <h5 class="fw-bold mb-3">Filters</h5>

                    <!-- The main filter form wraps all controls -->
                    <form th:action="@{/products}" method="get" id="filterForm">

                        <!-- Hidden fields to preserve state across filter changes -->
                        <input type="hidden" name="category" th:value="${currentCategory == 'All Products' ? '' : currentCategory}">
                        <input type="hidden" name="sortBy" th:value="${selectedSortBy}">

                        <!-- Filter Group: Price Range -->
                        <div class="filter-group">
                            <h6 class="fw-bold">Filter by Price</h6>
                            <label for="priceRangeMin" class="small">Min Price: ₹ <span id="priceMinDisplay" th:text="${#numbers.formatDecimal(minPriceValue ?: 0, 0, 'COMMA', 0, 'POINT')}">0</span></label>
                            <input type="range" class="form-range" id="priceRangeMin" min="0" max="10000" step="100"
                                   name="minPrice" th:value="${minPriceValue ?: 0}"
                                   oninput="document.getElementById('priceMinDisplay').textContent = parseInt(this.value).toLocaleString('en-IN');">

                            <label for="priceRangeMax" class="small">Max Price: ₹ <span id="priceMaxDisplay" th:text="${#numbers.formatDecimal(maxPriceValue ?: 10000, 0, 'COMMA', 0, 'POINT')}">10000</span></label>
                            <input type="range" class="form-range" id="priceRangeMax" min="0" max="10000" step="100"
                                   name="maxPrice" th:value="${maxPriceValue ?: 10000}"
                                   oninput="document.getElementById('priceMaxDisplay').textContent = parseInt(this.value).toLocaleString('en-IN');">

                            <button type="submit" class="btn btn-sm btn-outline-secondary w-100 mt-2">Apply Price Filter</button>
                        </div>

                        <!-- Filter Group: Status / Stock -->
                        <div class="filter-group">
                            <h6 class="fw-bold">Filter by Status</h6>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="status" id="statusInStock" value="inStock"
                                       th:checked="${selectedStatus == 'inStock'}">
                                <label class="form-check-label" for="statusInStock">In Stock</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="status" id="statusLowStock" value="lowStock"
                                       th:checked="${selectedStatus == 'lowStock'}">
                                <label class="form-check-label" for="statusLowStock">Low Stock (5 or less)</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="status" id="statusOnSale" value="onSale"
                                       th:checked="${selectedStatus == 'onSale'}">
                                <label class="form-check-label" for="statusOnSale">On Sale (Requires Database Field)</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="status" id="statusAll" value=""
                                       th:checked="${selectedStatus == null or selectedStatus == ''}">
                                <label class="form-check-label" for="statusAll">All Status</label>
                            </div>
                            <button type="submit" class="btn btn-sm btn-outline-secondary w-100 mt-2">Apply Status Filter</button>
                        </div>

                        <!-- Filter Group: Color Swatches (Using submit on change for quick filtering) -->
                        <div class="filter-group">
                            <h6 class="fw-bold">Colour</h6>
                            <div class="d-flex flex-wrap">
                                <label th:each="colorName : ${filterColors}" class="color-label">
                                    <input type="radio" name="color" th:value="${colorName}" style="display: none;"
                                           th:checked="${selectedColor == colorName}" onchange="this.form.submit()">
                                    <div class="color-swatch-wrapper">
                                        <span class="color-swatch"
                                              th:style="'background-color: ' + ${colorName}"
                                              th:classappend="${selectedColor == colorName} ? 'active'"></span>
                                    </div>
                                    <span>[[${colorName}]]</span>
                                </label>

                                <!-- Option to clear color filter -->
                                <label class="color-label">
                                    <input type="radio" name="color" value="" style="display: none;"
                                           th:checked="${selectedColor == null or selectedColor == ''}" onchange="this.form.submit()">
                                    <div class="color-swatch-wrapper">
                                        <span class="color-swatch" style="background-color: white; border-color: #ddd;"></span>
                                    </div>
                                    <span>All</span>
                                </label>
                            </div>
                        </div>

                    </form>

                    <!-- Sidebar: Product Categories (Links that navigate away, included for context) -->
                    <div class="filter-group">
                        <h6 class="fw-bold">Product Categories</h6>
                        <ul class="list-unstyled small">
                            <!-- Preserve current filters when changing category -->
                            <li th:each="cat : ${allCategories}">
                                <a th:href="@{/products(category=${cat})}" th:text="${cat}"
                                   th:classappend="${currentCategory == cat} ? 'fw-bold'"></a>
                            </li>
                            <li><a th:href="@{/products}" class="fw-bold" th:classappend="${currentCategory == 'All Products'} ? 'active'">All Products</a></li>
                        </ul>
                    </div>

                </div>
            </div>

            <!-- Right Column: Sorting and Product Grid (col-lg-9) -->
            <div class="col-lg-9">

                <!-- Top Bar: Sorting -->
                <div class="d-flex justify-content-end align-items-center mb-4">
                    <form th:action="@{/products}" method="get" id="sortForm">
                        <!-- Hidden fields to preserve current filter state when sorting -->
                        <input type="hidden" name="category" th:value="${currentCategory == 'All Products' ? '' : currentCategory}">
                        <input type="hidden" name="minPrice" th:value="${minPriceValue}">
                        <input type="hidden" name="maxPrice" th:value="${maxPriceValue}">
                        <input type="hidden" name="status" th:value="${selectedStatus}">
                        <input type="hidden" name="color" th:value="${selectedColor}">

                        <label for="sortBySelect" class="form-label me-2 mb-0 small">Sort By:</label>
                        <select name="sortBy" id="sortBySelect" class="form-select form-select-sm d-inline-block w-auto" onchange="this.form.submit()">
                            <option value="latest" th:selected="${selectedSortBy == 'latest'}">Latest Arrivals</option>
                            <option value="oldest" th:selected="${selectedSortBy == 'oldest'}">Oldest</option>
                            <option value="priceAsc" th:selected="${selectedSortBy == 'priceAsc'}">Price: Low to High</option>
                            <option value="priceDesc" th:selected="${selectedSortBy == 'priceDesc'}">Price: High to Low</option>
                        </select>
                    </form>
                </div>

                <!-- Product Grid -->
                <div th:if="${#lists.isEmpty(products)}" class="alert alert-warning text-center">
                    <p class="lead mb-0">No products found matching the current filters.</p>
                </div>

                <div class="row g-4">
                    <!-- Loop through products provided by ProductController -->
                    <div class="col-sm-6 col-md-4" th:each="p : ${products}">
                        <div class="card product-card shadow-sm h-100">
                            <!-- Product Image -->
                            <img th:src="${p.imageUrl != null ? p.imageUrl : 'https://placehold.co/600x600/ccc/333?text=No+Image'}"
                                 onerror="this.onerror=null; this.src='https://placehold.co/600x600/ccc/333?text=Error+Loading';"
                                 class="card-img-top"
                                 alt="Product Image">

                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title" th:text="${p.name}">Product Name</h5>
                                <p class="text-muted small mb-2" th:text="${p.category}"></p>

                                <p class="card-text text-success fw-bold fs-5 mt-auto">
                                    ₹ <span th:text="${#numbers.formatDecimal(p.price, 0, 'COMMA', 2, 'POINT')}">0.00</span>
                                </p>
                                <p class="card-text text-muted small">
                                    Stock: <span th:text="${p.stockQuantity}">0</span>
                                </p>

                                <!-- Actions for Authenticated Users (Cart/Wishlist) -->
                                <div class="mt-2 btn-group" role="group" sec:authorize="isAuthenticated()">
                                    <!-- ADD TO CART -->
                                    <form th:action="@{/cart/add}" method="post" class="d-inline w-50">
                                        <input type="hidden" name="productId" th:value="${p.id}">
                                        <input type="hidden" name="quantity" value="1">
                                        <button type="submit" class="btn btn-brand w-100 btn-sm" th:disabled="${p.stockQuantity == 0}">
                                            <i class="fa fa-shopping-bag me-1"></i> Cart
                                        </button>
                                    </form>

                                    <!-- ADD TO WISHLIST -->
                                    <form th:action="@{/wishlist/add/{productId}(productId=${p.id})}" method="post" class="d-inline w-50">
                                        <button type="submit" class="btn btn-outline-danger w-100 btn-sm">
                                            <i class="fa-regular fa-heart"></i>
                                        </button>
                                    </form>
                                </div>

                                <a th:href="@{'/products/' + ${p.id}}"
                                   th:classappend="${#authentication.name} == 'anonymousUser' ? 'w-100' : ''"
                                   class="btn btn-dark btn-sm mt-2">
                                    View Details
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- END Main Content Wrapper -->

<!-- FOOTER (Standardized structure) -->
<footer class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-md-4 mb-3"><h5>Anvi Studio</h5><p class="small">Handpicked ethnic wear for every occasion.</p></div>
            <div class="col-md-2 mb-3"><h6>Shop</h6><ul class="list-unstyled small"><li><a th:href="@{/products(category='Sarees')}" class="text-white">Sarees</a></li><li><a th:href="@{/products(category='Lehengas')}" class="text-white">Lehengas</a></li></ul></div>
            <div class="col-md-3 mb-3"><h6>Contact</h6><p class="small">Vijayawada, India<br><a href="mailto:avnistudio@gmail.com" class="text-white">avnistudio@gmail.com</a></p></div>
            <div class="col-md-3 mb-3"><h6>Follow</h6><div class="d-flex my-3 fs-5"><a href="https://www.facebook.com/bharatheswar.kodali/" class="text-white me-3"><i class="fab fa-facebook-f"></i></a><a href="https://www.instagram.com/avnistudio" class="text-white me-3"><i class="fab fa-instagram"></i></a><a href="https://wa.me/919490334557" class="text-white"><i class="fab fa-whatsapp"></i></a></div></div>
        </div>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // This is necessary to handle the initial state of the price range slider input
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize slider values based on current filter state
        const minPriceRange = document.getElementById('priceRangeMin');
        const maxPriceRange = document.getElementById('priceRangeMax');
        const minPriceDisplay = document.getElementById('priceMinDisplay');
        const maxPriceDisplay = document.getElementById('priceMaxDisplay');
        const filterForm = document.getElementById('filterForm');

        if (minPriceRange && maxPriceRange && filterForm) {

            // Function to update displays and check constraints
            const updatePriceValues = () => {
                const minVal = parseInt(minPriceRange.value);
                const maxVal = parseInt(maxPriceRange.value);

                // Constraint: Ensure min <= max visually
                if (minVal > maxVal) {
                    minPriceRange.value = maxVal;
                }

                // Update text displays with Indian number formatting
                minPriceDisplay.textContent = parseInt(minPriceRange.value).toLocaleString('en-IN');
                maxPriceDisplay.textContent = parseInt(maxPriceRange.value).toLocaleString('en-IN');
            };

            // Event listeners for real-time display update
            minPriceRange.addEventListener('input', updatePriceValues);
            maxPriceRange.addEventListener('input', updatePriceValues);

            // Initial call to set correct starting values if present in model
            updatePriceValues();
        }
    });
</script>
</body>
</html>


<!--
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title th:text="${currentCategory} + ' | Anvi Studio'"></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <style>
        :root{ &#45;&#45;brand:#ff7c04; &#45;&#45;dark:#222; }
        /* Fix: Set min-height for full viewport and remove default margin/padding if needed */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f7f7f7;
            color: #222;
            min-height: 100vh; /* Ensure full viewport coverage */
            display: flex;
            flex-direction: column; /* Allows footer to be pushed to the bottom */
        }
        /* New Style for Offer Bar */
        .offer-bar{
            background: linear-gradient(90deg,#111, #222);
            color:#fff;
            padding:6px 0;
            font-size:0.95rem;
        }
        .offer-bar a{ color:var(&#45;&#45;brand); text-decoration:none; font-weight:600; }

        .main-nav{ background:#000; color:#fff; }
        /* *** FIX: Ensure active links are always clearly visible *** */
        .main-nav .nav-link{ color:#fff; }
        .main-nav .nav-link:hover,
        .main-nav .nav-link.active {
            color: var(&#45;&#45;brand); /* Active/Hover color */
            font-weight: 700;    /* Make active link bold */
            border-bottom: 2px solid var(&#45;&#45;brand); /* Subtle underline for clarity */
            padding-bottom: 4px;
        }
        /* *** END FIX *** */

        .navbar-nav { align-items: center; }
        .product-card{ border-radius:12px; overflow:hidden; border:1px solid #eee; }
        .product-card .card-img-top{ height:350px; object-fit:cover; }
        .btn-brand { background-color: var(&#45;&#45;brand); border-color: var(&#45;&#45;brand); color: white; }
        .btn-brand:hover { background-color: #cc6300; border-color: #cc6300; }
        .hero-title { font-family: 'Playfair Display', serif; font-weight: 700; color: #000; }

        /* Content wrapper to allow the footer to stick to the bottom */
        .main-content {
            flex-grow: 1; /* This pushes the footer down */
        }

        /* Footer styling for consistency */
        footer {
            background-color: var(&#45;&#45;dark);
            color: #fff;
        }
    </style>
</head>
<body>

&lt;!&ndash; 1. ADDED: Offer bar for consistency &ndash;&gt;
<div class="offer-bar text-center">
    <div class="container">Free Shipping on Orders Above ₹1999 — Use code <a href="#" style="color:var(&#45;&#45;brand); text-decoration:none; font-weight:600;">FREESHIP</a></div>
</div>

&lt;!&ndash; NAVBAR (Standardized from index.html) &ndash;&gt;
<nav class="navbar navbar-expand-lg main-nav">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="/">
            <img th:src="@{/images/Chaknik_Logo.png}" alt="Anvi Studio Logo" style="height:75px; margin-right:4px;">
            <span class="text-white">Anvi's Studio</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="mainNav">

            &lt;!&ndash; 1. MAIN LINKS (Using the expanded list of categories) &ndash;&gt;
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                &lt;!&ndash; *** NEW ARRIVALS TAB *** &ndash;&gt;
                <li class="nav-item">
                    <a class="nav-link"
                       th:classappend="${param.sort != null and param.sort[0] == 'newest'} ? 'active'"
                       th:href="@{/products(sort='newest')}">New Arrivals</a>
                </li>

                <li class="nav-item dropdown"
                    th:classappend="${currentCategory != 'All Products' and currentCategory != null and param.sort == null} ? 'active'">
                    <a class="nav-link dropdown-toggle"
                       href="#" id="shopDropdown" role="button"
                       data-bs-toggle="dropdown"
                       th:classappend="${currentCategory != 'All Products' and currentCategory != null and param.sort == null} ? 'active'">Shop</a>
                    <ul class="dropdown-menu" aria-labelledby="shopDropdown">
                        <li><a class="dropdown-item" th:href="@{/products(category='Long Frocks')}">Long Frocks</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Lehengas')}">Lehengas</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Mom & Me')}">Mom & Me</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Crop Top – Skirts')}">Crop Top – Skirts</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Handlooms')}">Handlooms</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Casual Frocks')}">Casual Frocks</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Ready To Wear')}">Ready To Wear</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Dupattas')}">Dupattas</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Kids wear')}">Kids wear</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Dress Material')}">Dress Material</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Sarees')}">Sarees</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Blouses')}">Blouses</a></li>
                        <li><a class="dropdown-item" th:href="@{/products(category='Fabrics')}">Fabrics</a></li>
                        <li><hr class="dropdown-divider"></li>
                        &lt;!&ndash; Active class for 'All Products' link &ndash;&gt;
                        <li><a class="dropdown-item"
                               th:classappend="${currentCategory == 'All Products' and param.sort == null} ? 'active'"
                               th:href="@{/products}">All Products</a></li>
                    </ul>
                </li>
                <li class="nav-item"><a class="nav-link" href="/about">About</a></li>
                <li class="nav-item"><a class="nav-link" href="/contact">Contact</a></li>
            </ul>

            &lt;!&ndash; 2. ICON GROUP (Right side) &ndash;&gt;
            <ul class="navbar-nav mb-2 mb-lg-0">
                <li class="nav-item" sec:authorize="!isAuthenticated()">
                    <a class="nav-link" th:href="@{/login}" title="Login"><i class="fa fa-user"></i></a>
                </li>
                <li class="nav-item" sec:authorize="isAuthenticated()">
                    <span class="nav-link text-white"><i class="fa fa-user me-1"></i><span sec:authentication="name">User</span></span>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/wishlist-unauth}" sec:authorize="!isAuthenticated()" title="Wishlist"><i class="fa-regular fa-heart"></i></a>
                    <a class="nav-link" th:href="@{/wishlist}" sec:authorize="isAuthenticated()" title="My Wishlist"><i class="fa-regular fa-heart"></i></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/cart-unauth}" sec:authorize="!isAuthenticated()" title="Cart"><i class="fa fa-shopping-cart"></i></a>
                    <a class="nav-link" th:href="@{/cart}" sec:authorize="isAuthenticated()" title="My Cart"><i class="fa fa-shopping-cart"></i></a>
                </li>
                <li class="nav-item" sec:authorize="isAuthenticated()">
                    <form th:action="@{/logout}" method="post" class="d-inline">
                        <button type="submit" class="btn btn-danger btn-sm"><i class="fa fa-sign-out-alt me-1"></i> Logout</button>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</nav>

&lt;!&ndash; 2. ADDED: Main Content Wrapper &ndash;&gt;
<div class="main-content">
    <div class="container my-5">
        <h1 class="hero-title display-5 mb-4 text-center" th:text="${currentCategory}">Product Catalog</h1>
        <hr class="mb-5">

        <div th:if="${#lists.isEmpty(products)}" class="alert alert-warning text-center">
            <p class="lead mb-0">No products found for the category: <span th:text="${currentCategory}"></span>.</p>
            <p class="mt-2">Please try browsing <a th:href="@{/products}" class="alert-link">All Products</a>.</p>
        </div>

        <div class="row g-4">
            &lt;!&ndash; Loop through products provided by ProductController &ndash;&gt;
            <div class="col-sm-6 col-md-4 col-lg-3" th:each="p : ${products}">
                <div class="card product-card shadow-sm h-100">
                    &lt;!&ndash; Product Image &ndash;&gt;
                    <img th:src="${p.imageUrl != null ? p.imageUrl : 'https://placehold.co/600x600/ccc/333?text=No+Image'}"
                         onerror="this.onerror=null; this.src='https://placehold.co/600x600/ccc/333?text=Error+Loading';"
                         class="card-img-top"
                         alt="Product Image">

                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title" th:text="${p.name}">Product Name</h5>
                        <p class="text-muted small mb-2" th:text="${p.category}"></p>

                        <p class="card-text text-success fw-bold fs-5 mt-auto">
                            ₹ <span th:text="${#numbers.formatDecimal(p.price, 0, 'COMMA', 2, 'POINT')}">0.00</span>
                        </p>
                        <p class="card-text text-muted small">
                            Stock: <span th:text="${p.stockQuantity}">0</span>
                        </p>

                        &lt;!&ndash; Actions for Authenticated Users (Cart/Wishlist) &ndash;&gt;
                        <div class="mt-2 btn-group" role="group" sec:authorize="isAuthenticated()">
                            &lt;!&ndash; ADD TO CART &ndash;&gt;
                            <form th:action="@{/cart/add}" method="post" class="d-inline w-50">
                                <input type="hidden" name="productId" th:value="${p.id}">
                                <input type="hidden" name="quantity" value="1">
                                <button type="submit" class="btn btn-brand w-100 btn-sm" th:disabled="${p.stockQuantity == 0}">
                                    <i class="fa fa-shopping-bag me-1"></i> Cart
                                </button>
                            </form>

                            &lt;!&ndash; ADD TO WISHLIST &ndash;&gt;
                            <form th:action="@{/wishlist/add/{productId}(productId=${p.id})}" method="post" class="d-inline w-50">
                                <button type="submit" class="btn btn-outline-danger w-100 btn-sm">
                                    <i class="fa-regular fa-heart"></i>
                                </button>
                            </form>
                        </div>

                        <a th:href="@{'/products/' + ${p.id}}"
                           th:classappend="${#authentication.name} == 'anonymousUser' ? 'w-100' : ''"
                           class="btn btn-dark btn-sm mt-2">
                            View Details
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
&lt;!&ndash; END Main Content Wrapper &ndash;&gt;

&lt;!&ndash; FOOTER (Standardized structure) &ndash;&gt;
<footer class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-md-4 mb-3"><h5>Anvi Studio</h5><p class="small">Handpicked ethnic wear for every occasion.</p></div>
            <div class="col-md-2 mb-3"><h6>Shop</h6><ul class="list-unstyled small"><li><a th:href="@{/products(category='Sarees')}" class="text-white">Sarees</a></li><li><a th:href="@{/products(category='Lehengas')}" class="text-white">Lehengas</a></li></ul></div>
            <div class="col-md-3 mb-3"><h6>Contact</h6><p class="small">Vijayawada, India<br><a href="mailto:avnistudio@gmail.com" class="text-white">avnistudio@gmail.com</a></p></div>
            <div class="col-md-3 mb-3"><h6>Follow</h6><div class="d-flex my-3 fs-5"><a href="https://www.facebook.com/bharatheswar.kodali/" class="text-white me-3"><i class="fab fa-facebook-f"></i></a><a href="https://www.instagram.com/avnistudio" class="text-white me-3"><i class="fab fa-instagram"></i></a><a href="https://wa.me/919490334557" class="text-white"><i class="fab fa-whatsapp"></i></a></div></div>
        </div>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>-->
