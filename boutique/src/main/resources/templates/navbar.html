<div xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" th:fragment="main-navbar">
    <!-- Offer bar (Sticky top content before main nav) -->
    <div class="offer-bar text-center">
        <div class="container">Free Shipping on Orders Above ₹1999 — Use code <a href="#" style="color:var(--brand); text-decoration:none; font-weight:600;">FREESHIP</a></div>
    </div>

    <!-- NAVBAR: Start of Reusable Nav Block -->
    <nav class="navbar navbar-expand-lg main-nav">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" th:href="@{/}">
                <img th:src="@{/images/Chaknik_Logo.png}" alt="Anvi Studio Logo" style="height:75px; margin-right:4px;">
                <span class="text-white">Anvi Studio</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="mainNav">

                <!-- 1. UNIFIED SEARCH BAR (Aligned left, before main links) -->
                <form th:action="@{/products}" method="get" class="d-flex me-4 my-2 my-lg-0">
                    <div class="input-group">
                        <input type="search" name="keyword" class="form-control form-control-sm" placeholder="Search products, SKU, color..." aria-label="Search" style="width: 250px;">
                        <button class="btn btn-outline-light btn-sm" type="submit">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>
                </form>

                <!-- 2. MAIN LINKS -->
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <!-- The active class should be dynamically applied by each page when using this fragment -->
                    <li class="nav-item"><a class="nav-link" th:href="@{/}" th:classappend="${currentPage == 'home' ? 'active' : ''}">Home</a></li>
                    <li class="nav-item"><a class="nav-link" th:href="@{/products(sort='newest')}" th:classappend="${currentPage == 'newArrivals' ? 'active' : ''}">New Arrivals</a></li>

                    <!-- SHOP DROPDOWN -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="shopDropdown" role="button" data-bs-toggle="dropdown" th:classappend="${currentPage == 'shop' ? 'active' : ''}">Shop</a>
                        <ul class="dropdown-menu" aria-labelledby="shopDropdown">
                            <li><a class="dropdown-item" th:href="@{/products(category='Long Frocks')}">Long Frocks</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Lehengas')}">Lehengas</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Mom & Me')}">Mom & Me</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Crop Top – Skirts')}">Crop Top – Skirts</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Handlooms')}">Handlooms</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Casual Frocks')}">Casual Frocks</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Ready To Wear')}">Ready To Wear</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Dupattas')}">Dupattas</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Kids wear')}">Kids wear</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Dress Material')}">Dress Material</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Sarees')}">Sarees</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Blouses')}">Blouses</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Fabrics')}">Fabrics</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" th:href="@{/products}">All Products</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link" th:href="@{/about}" th:classappend="${currentPage == 'about' ? 'active' : ''}">About</a></li>
                    <li class="nav-item"><a class="nav-link" th:href="@{/contact}" th:classappend="${currentPage == 'contact' ? 'active' : ''}">Contact</a></li>
                   <!-- <li class="nav-item"><a class="nav-link" th:href="@{/custom-request}" th:classappend="${currentPage == 'customRequest' ? 'active' : ''}">Custom Request</a></li>-->
                </ul>

                <!-- 3. ICON GROUP (Right side) -->
                <ul class="navbar-nav mb-2 mb-lg-0">

                    <!-- LOGIN/WELCOME/PROFILE -->
                    <li class="nav-item" sec:authorize="!isAuthenticated()">
                        <a class="nav-link" th:href="@{/login}" title="Login">
                            <i class="fa fa-user"></i>
                        </a>
                    </li>
                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <span class="nav-link text-white">
                            <i class="fa fa-user me-1"></i>
                            <!-- Check if 'customer' attribute is available (set by HomeController) -->
                            <span th:if="${customer != null}" th:text="'Welcome, ' + ${customer.firstName}">Welcome, Customer</span>
                            <span th:unless="${customer != null}" sec:authentication="name">User</span>
                        </span>
                    </li>

                    <!-- WISHLIST ICON -->
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/wishlist-unauth}" sec:authorize="!isAuthenticated()" title="Wishlist">
                            <i class="fa-regular fa-heart"></i>
                        </a>
                        <a class="nav-link" th:href="@{/wishlist}" sec:authorize="isAuthenticated()" title="My Wishlist">
                            <i class="fa-regular fa-heart"></i>
                        </a>
                    </li>

                    <!-- CART ICON -->
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/cart-unauth}" sec:authorize="!isAuthenticated()" title="Cart">
                            <i class="fa fa-shopping-cart"></i>
                        </a>
                        <a class="nav-link" th:href="@{/cart}" sec:authorize="isAuthenticated()" title="My Cart">
                            <i class="fa fa-shopping-cart"></i>
                        </a>
                    </li>

                    <!-- LOGOUT BUTTON -->
                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <form th:action="@{/logout}" method="post" class="d-inline">
                            <button type="submit" class="btn btn-danger btn-sm">
                                <i class="fa fa-sign-out-alt me-1"></i> Logout
                            </button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- NAVBAR: End of Reusable Nav Block -->
</div>